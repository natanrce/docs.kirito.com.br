# Aquisição de aplicativos: o primeiro passo para o pentest mobile

## Prefácio
Se você trabalha com Pentest Mobile ou já realizou testes de invasão de forma esporádica, certamente já enfrentou a situação de não ter acesso ao aplicativo que precisa testar. E quando isso acontece, é comum receber do cliente a seguinte mensagem: **"Mas você não é o hacker? Então dá um jeito de conseguir o app!"**.

Essa situação é bastante comum, mas é importante lembrar que existem formas e técnicas específicas para garantir a integridade do aplicativo durante o processo de aquisição. Embora seja tentador recorrer a sites que oferecem o download do apk ou ipa de forma rápida e fácil, eles geralmente adicionam surpresas indesejáveis dentro dos aplicativos. Dessa forma, vou abordar nesta seção formas seguras e confiáveis de obter o aplicativo necessário para o Pentest Mobile.

## Formas de aquisição
Como mencionado no prólogo, as principais formas de adquirir um aplicativo são:

1. Instalando o aplicativo via Google Play Store em um dispositivo físico ou emulado:
* Processo confiável e seguro, mas requer que o analista reserve alguns minutos para preparar o ambiente e fazer o download do aplicativo.

1. Utilizando sites de terceiros para realizar o download do aplicativo:
* Processo não confiável que pode resultar na infecção do aplicativo e, consequentemente, na infecção do ambiente de teste.

## Adquirindo via Google Play Store
Uma vez que a primeira opção é mais confiável e segura, abaixo mostraremos o passo a passo para adquirir um aplicativo através da Google Play Store utilizando um dispositivo emulado.

## Configurando o ambiente virtual

Antes de qualquer coisa, é necessário criar um dispositivo virtual utilizando uma imagem que contenha a Google Play Store. No exemplo abaixo, utilizaremos o Android 12.0 (Google Play) na API Level 31 de ABI x86_64.

![Application_acquisition_img0](/mobile/application_acquisition/app_acquisition_img0.png)

1. Após iniciar o dispositivo virtual, acesse a Google Play Store e faça a instalação do aplicativo desejado. Neste exemplo, selecionei o WhatsApp Messenger.

![Application_acquisition_img1](/mobile/application_acquisition/app_acquisition_img1.png)

2. Após a instalação, acesse o site da Google Play Store e busque pelo aplicativo desejado.

[Apps Android no Google Play](https://play.google.com/store/games?hl=pt_BR&gl=US)

![Application_acquisition_img2](/mobile/application_acquisition/app_acquisition_img2.png)

Observe que o nome do pacote é exibido na URL após o parâmetro **"ID"**. Anote essa informação, pois a utilizaremos posteriormente.

3. Caso não deseje buscar o nome do pacote através do Google Play Store e já tenha o app instalado no device, utilize o comando **`adb shell 'pm list packages' | sed 's/.*://g'`** para listar todos os pacotes instalados no dispositivo.

Todas as aplicações no ambiente Android são salvas no caminho **`/data/app/package_name/`**. No entanto, usuários comuns não têm permissão para listar as informações contidas dentro desse diretório. Dessa forma, para extrair o caminho completo da aplicação, execute o seguinte comando:

```bash
adb shell
```
```bash
pm path com.whatsapp
```

Substitua a string **"com.whatsapp"** pelo nome do pacote identificado na URL da Google Play Store ou identificado após a execução do passo 3.

![Application_acquisition_img3](/mobile/application_acquisition/app_acquisition_img3.png)

4. Copie o caminho resultante do comando acima e baixe o aplicativo para sua máquina local.

```bash
adb pull "/data/app/~~Y28-2Gnz_hlc4bdSHvLJOA==/com.whatsapp-u_k5sTjhJ-nREe6L_e8YzQ==/base.apk" teste.apk
```

![Application_acquisition_img4](/mobile/application_acquisition/app_acquisition_img4.png)

5. A partir desse ponto, já temos o aplicativo para realização dos testes. Basta iniciar o dispositivo virtual com acesso root e realizar o processo de instalação normalmente.

```bash
adb install teste.apk
```

![Application_acquisition_img5](/mobile/application_acquisition/app_acquisition_img5.png)

> **Observação:** É importante ressaltar que não apoio a execução de testes de segurança em ambientes não controlados sem a permissão e consentimento prévios dos responsáveis pela aplicação. Acreditamos que a realização de testes de segurança deve ser feita de maneira ética e responsável, em conformidade com as políticas e regulamentações aplicáveis